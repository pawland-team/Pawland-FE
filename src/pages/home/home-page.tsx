import { useEffect, useState } from 'react';

import { InferGetServerSidePropsType } from 'next';
import { Inter } from 'next/font/google';
import Head from 'next/head';
import Link from 'next/link';
import styled from 'styled-components';

import { useGetTodoList } from '@entities/todo/hooks';
import { TodoList } from '@entities/todo/ui';
import { AddTodoForm } from '@features/add-todo/ui';
import { SwitchOnQueryState } from '@shared/utils/switch-on-query-status';

import { getServerSideProps } from '@/pages';

const inter = Inter({ subsets: ['latin'] });

export const HomePage = ({ test }: InferGetServerSidePropsType<typeof getServerSideProps>) => {
  const [ttt, setTest] = useState<string>(test);

  const { data, status } = useGetTodoList();

  useEffect(() => {
    setTest(test);
  }, [test]);

  return (
    <>
      <Head>
        <title>Pawland Home</title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <header>
        <nav>
          <ul>
            <li>
              <Link href='/second'>move to second</Link>
            </li>
          </ul>
        </nav>
      </header>
      <main className={`${inter.className}`}>
        <S.TestH1>{ttt}</S.TestH1>
        <AddTodoForm />
        <SwitchOnQueryState
          status={status}
          onPending={<div>Loading...</div>}
          onError={<div>Error</div>}
          onSuccess={status === 'success' && <TodoList todoList={data} />}
        />
      </main>
    </>
  );
};

const S = {
  TestH1: styled.h1`
    font-size: 3rem;
    font-weight: 900;
  `,
};
